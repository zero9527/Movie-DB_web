{"version":3,"sources":["webpack:///./src/views/search-list/search-list.scss?9765","views/search-list/search-list.scss","views/search-list/index.tsx"],"names":["content","__webpack_require__","module","i","options","hmr","transform","locals","exports","push","search","no-data","movie-item","movie-item-pic","img","movie-item-content","initMovie","title","images","medium","rating","average","initialState","isLoading","input","searchList","scrTop","SearchList","_super","props","_this","call","this","state","_onScroll","bind","Object","tslib__WEBPACK_IMPORTED_MODULE_2__","prototype","componentDidMount","res","_utils__WEBPACK_IMPORTED_MODULE_8__","setState","decodeURI","searchMovie","history","listen","route","onRouteChange","window","addEventListener","componentWillUnmount","removeEventListener","pathname","setScrollTop","includes","top","document","body","scrollTop","documentElement","location","cache","localStorage","getItem","searchRes","JSON","parse","filter","item","setTimeout","Array","isArray","antd_mobile_lib_toast__WEBPACK_IMPORTED_MODULE_1___default","a","fail","toDetail","id","onChange","val","inputTimer","clearTimeout","onConfirm","isDetailPage","render","_a","react__WEBPACK_IMPORTED_MODULE_3__","className","_search_list_scss__WEBPACK_IMPORTED_MODULE_10___default","style","paddingTop","display","_components_header_search__WEBPACK_IMPORTED_MODULE_4__","value","onClear","_components_loading__WEBPACK_IMPORTED_MODULE_6__","MovieItem","movieList","_components_scrollToTop__WEBPACK_IMPORTED_MODULE_7__","children","_b","_c","_d","length","map","index","key","onClick","src","small","alt","_components_star__WEBPACK_IMPORTED_MODULE_5__","score","readonly","__webpack_exports__","react_router__WEBPACK_IMPORTED_MODULE_9__"],"mappings":"6EAGA,IAAAA,EAAcC,EAAQ,KACtB,iBAAAD,QAA4CE,EAAAC,EAASH,EAAA,MAOxCC,EAAQ,GAARA,CAA8DD,EAH3EI,CAAeC,OACfC,mBAGAN,EAAAO,SAAAL,EAAAM,QAAAR,EAAAO,8BCZAC,EAAAN,EAAAM,QAA2BP,EAAQ,GAARA,UAK3BQ,MAAcP,EAAAC,EAAS,4XAA0X,KAGjZK,EAAAD,QACAG,OAAA,iBACAC,UAAA,kBACAC,aAAA,qBACAC,iBAAA,yBACAC,IAAA,cACAC,qBAAA,sLCIMC,IACFC,MAAO,GAAIC,OAAOA,CAAGC,OAAQ,IAAKC,OAAOA,CAAGC,QAAS,MAEnDC,GACJC,WAAUA,EACVC,MAAO,GACPC,WAAYT,EACZU,OAAQ,GAMVC,EAAA,SAAAC,GAIE,SAAAD,EAAYE,GAAZ,IAAAC,EACEF,EAAAG,KAAAC,KAAMH,IAAMG,YAJEF,EAAAG,MAA0BX,EAKxCQ,EAAKI,UAAYJ,EAAKI,UAAUC,KAAKL,KAoJzC,OA1JyBM,OAAAC,EAAA,EAAAD,CAAAT,EAAAC,GAShBD,EAAAW,UAAAC,kBAAP,eAAAT,EAAAE,KACMQ,EAAMJ,OAAAK,EAAA,EAAAL,GACLI,GAAQA,EAAIhB,QAEjBQ,KAAKU,SAASA,CACZlB,MAAOmB,UAAUH,EAAIhB,SAEvBQ,KAAKY,YAAYD,UAAUH,EAAIhB,QAE/BQ,KAAKH,MAAMgB,QAAQC,QAAO,SAAAC,GACxBjB,EAAKkB,cAAcD,MAGrBE,OAAOC,iBAAiB,SAAUlB,KAAKE,aAGlCP,EAAAW,UAAAa,qBAAP,WAEEnB,KAAKU,SAAW,aAChBO,OAAOG,oBAAoB,SAAUpB,KAAKE,YAIrCP,EAAAW,UAAAU,cAAP,SAAqBD,GAEnB,GAAuB,YAAnBA,EAAMM,SAAwB,CACxB,IAAA3B,EAAAM,KAAAC,MAAAP,OACRuB,OAAOC,iBAAiB,SAAUlB,KAAKE,WAEvCF,KAAKsB,aAAa5B,GAGhBqB,EAAMM,SAASE,SAAS,oBAE1BvB,KAAKsB,aAAa,GAClBL,OAAOG,oBAAoB,SAAUpB,KAAKE,aAKvCP,EAAAW,UAAAgB,aAAP,SAAoBE,GAClBC,SAASC,KAAKC,UAAYH,EAC1BC,SAASG,gBAAgBD,UAAYH,GAGhC7B,EAAAW,UAAAJ,UAAP,WACE,IAAMyB,EAAYF,SAASC,KAAKC,WAAaF,SAASG,gBAAgBD,UAEjC,YAAjC3B,KAAKH,MAAMgC,SAASR,SACtBrB,KAAKU,SAASA,CAAEhB,OAAQiC,IAExBV,OAAOG,oBAAoB,SAAUpB,KAAKE,YAKvCP,EAAAW,UAAAM,YAAP,SAAmBpB,GAAnB,IAAAM,EAAAE,KACE,YADiBR,MAAA,KACbQ,KAAKC,MAAMV,UAAf,CACAS,KAAKU,SAASA,CAAEnB,WAAUA,IAE1B,IAAMuC,EAAQC,aAAaC,QAAQ,kBAEnC,GAAIF,EAAO,CACT,IACIG,EADiBC,KAAKC,MAAML,GACDM,QAAO,SAACC,GAAc,OAAAA,EAAKpD,MAAMsC,SAAX/B,MAErD8C,YAAW,WACTxC,EAAKY,SAASA,CAAEnB,WAAUA,MACzB,KACHS,KAAKU,SAASA,CAAEjB,WAAYwC,SAG5B7B,OAAAK,EAAA,EAAAL,EAAkB,SAAAI,GAChB,IAAK+B,MAAMC,QAAQhC,GAGjB,OAFAV,EAAKY,SAASA,CAAEnB,WAAUA,SAC1BkD,EAAAC,EAAMC,KAAK,eAIb,IAAIV,EAAYzB,EAAI4B,QAAO,SAACC,GAAc,OAAAA,EAAKpD,MAAMsC,SAAX/B,MAE1C8C,YAAW,WACTxC,EAAKY,SAASA,CAAEnB,WAAUA,MACzB,KACHO,EAAKY,SAASA,CACZjB,WAAYwC,SAMbtC,EAAAW,UAAAsC,SAAP,SAAgBC,GACTA,GACL7C,KAAKH,MAAMgB,QAAQpC,KAAK,wBAAwBoE,IAG3ClD,EAAAW,UAAAwC,SAAP,SAAgBC,GAAhB,IAAAjD,EAAAE,cAAgB+C,MAAA,IACV/C,KAAKgD,YAAYC,aAAajD,KAAKgD,YACvChD,KAAKgD,WAAaV,YAAW,WAAM,OAAAxC,EAAKc,YAALmC,KAAuB,MAGrDpD,EAAAW,UAAA4C,UAAP,SAAiBH,GACf/C,KAAKY,YAAYmC,IAGZpD,EAAAW,UAAA6C,aAAP,WACE,OAAOnD,KAAKH,MAAMgC,SAASR,SAASE,SAAS,mBAGxC5B,EAAAW,UAAA8C,OAAP,eAAAtD,EAAAE,KACQqD,EAAArD,KAAAC,MACJT,EAAA6D,EAAA7D,MACAD,EAAA8D,EAAA9D,UACAE,EAAA4D,EAAA5D,WAGF,OACE6D,EAAA,qBACEC,UAAWC,EAAAd,EAAOhE,OAClB+E,OAASC,WAAY1D,KAAKmD,eAAiB,GAAK,SAEhDG,EAAA,qBACEC,UAAU,iBACVE,OAASE,QAAS3D,KAAKmD,eAAiB,OAAS,WAE/CnD,KAAKmD,gBACLG,EAAA,cAACM,EAAA,GACCC,MAAOrE,EACPsD,SAAU,SAACC,GAAQ,OAAAjD,EAAKgD,SAALC,IACnBG,UAAW,SAACH,GAAQ,OAAAjD,EAAKoD,UAALH,IACpBe,QAAS,WAAM,OAAAhE,EAAAc,iBAIlBrB,GAAa+D,EAAA,cAACS,EAAA,EAAD,MAEdT,EAAA,cAACU,GAAUC,UAAWxE,EAAYmD,SAAU,SAACC,GAAe,OAAA/C,EAAK8C,SAALC,MAE5DS,EAAA,cAACY,EAAA,EAAD,OAGDlE,KAAKH,MAAMsE,WAIpBxE,EA1JA,CAAyB2D,EAAA,WA4JzB,SAASU,EAAUX,OAAAe,WAAAf,OACjBgB,EAAAD,EAAAH,qBAAAI,EAAArF,EAAAqF,EACAC,EAAAF,EAAAxB,oBAAA0B,EAAA,SAAAzB,KAAAyB,EAEA,OACEhB,EAAA,yBACEA,EAAA,yBAASC,UAAU,QACjBD,EAAA,2CACAA,EAAA,6CACAA,EAAA,+CACAA,EAAA,0BAEFA,EAAA,qBAAKC,UAAcC,EAAAd,EAAO,cAAa,SAAvC,OAAuDuB,EAAU,IAAMA,EAAU,GAAGhF,MAASgF,EAAUM,OAAS,EAAhH,QACCN,EAAU,IAAMA,EAAU,GAAGhF,OAASgF,EAAUO,KAAI,SAACnC,EAAMoC,GAAU,OACpEnB,EAAA,yBAASC,UAAWC,EAAAd,EAAO,cAAegC,IAAKD,EAAOE,QAAS,WAAM,OAAA/B,EAASP,EAATQ,MACnES,EAAA,qBAAKC,UAAWC,EAAAd,EAAO,mBACrBY,EAAA,qBAAKsB,IAAKvC,EAAKnD,OAAO2F,MAAOC,IAAI,SAASvB,UAAWC,EAAAd,EAAO5D,OAE9DwE,EAAA,qBAAKC,UAAWC,EAAAd,EAAO,uBACrBY,EAAA,qBAAKC,UAAWC,EAAAd,EAAO,oBAAsBL,EAAKpD,OAClDqE,EAAA,qBAAKC,UAAcC,EAAAd,EAAO,oBAAmB,SAClB,IAAxBL,EAAKjD,OAAOC,QACTiE,EAAA,cAACA,EAAA,SAAD,KACEA,EAAA,cAACyB,EAAA,GAAKC,MAAQ3C,EAAKjD,OAAOC,QAAU4F,cACpC3B,EAAA,0BAAQjB,EAAKjD,OAAOC,UAEtBiE,EAAA,yCAUH4B,EAAA,QAAA9E,OAAA+E,EAAA,EAAA/E,CAAWT","file":"static/js/6.58b6e03f.chunk.js","sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/index.js??ref--5-oneOf-4-1!../../../node_modules/postcss-loader/lib/index.js??postcss!../../../node_modules/sass-loader/dist/cjs.js!../../../node_modules/sass-resources-loader/lib/loader.js??ref--5-oneOf-4-4!./search-list.scss\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {\"hmr\":true}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js??ref--5-oneOf-4-1!../../../node_modules/postcss-loader/lib/index.js??postcss!../../../node_modules/sass-loader/dist/cjs.js!../../../node_modules/sass-resources-loader/lib/loader.js??ref--5-oneOf-4-4!./search-list.scss\", function() {\n\t\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js??ref--5-oneOf-4-1!../../../node_modules/postcss-loader/lib/index.js??postcss!../../../node_modules/sass-loader/dist/cjs.js!../../../node_modules/sass-resources-loader/lib/loader.js??ref--5-oneOf-4-4!./search-list.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(undefined);\n// imports\n\n\n// module\nexports.push([module.id, \".search__19nYsb{width:100%}.no-data__3uIK5D{text-align:center;color:#999}.movie-item__3be2x_{display:-ms-flexbox;display:flex;margin-bottom:10px}.movie-item__3be2x_:active{background:#f6f6f6}.movie-item-pic__2ZZ9BI{width:60px;height:80px;margin-right:10px}.movie-item-pic__2ZZ9BI .img__2_bzD8{width:100%;height:100%}.movie-item-content__1abpQe{padding-top:4px;font-size:14px}\\n\", \"\"]);\n\n// exports\nexports.locals = {\n\t\"search\": \"search__19nYsb\",\n\t\"no-data\": \"no-data__3uIK5D\",\n\t\"movie-item\": \"movie-item__3be2x_\",\n\t\"movie-item-pic\": \"movie-item-pic__2ZZ9BI\",\n\t\"img\": \"img__2_bzD8\",\n\t\"movie-item-content\": \"movie-item-content__1abpQe\"\n};","import * as React from 'react';\n// import { useSelector, useDispatch } from 'react-redux';\n// import { iRootState, Dispatch } from '@/store-rematch';\nimport HeaderSearch from '@/components/header-search';\nimport Star from '@/components/star';\nimport Loading from '@/components/loading';\nimport TopBtn from '@/components/scrollToTop';\nimport { History } from 'history';\nimport { getMovieTop250All, getUrlParams } from '@/utils';\nimport { RouteComponentProps, withRouter } from 'react-router';\nimport { Toast } from 'antd-mobile';\nimport styles from './search-list.scss';\n\ninterface IProps extends RouteComponentProps {\n  history: History\n}\n\n// 占位初始化数据\nconst initMovie: any[] = [\n  { title: '', images: { medium: ''}, rating: { average: '' }},\n];\nconst initialState = {\n  isLoading: false,\n  input: '',\n  searchList: initMovie,\n  scrTop: 0\n};\n\ntype IState = typeof initialState;\n\n// 搜索电影，在Top250中匹配（搜索接口挂了。。。）\nclass SearchList extends React.Component<IProps> {\n  public readonly state: Readonly<IState> = initialState;\n  public inputTimer: any;\n\n  constructor(props: IProps) {\n    super(props);\n    this._onScroll = this._onScroll.bind(this);\n  }\n\n  public componentDidMount() {\n    let res = getUrlParams();\n    if (!res || !res.input) return;\n    \n    this.setState({\n      input: decodeURI(res.input)\n    });\n    this.searchMovie(decodeURI(res.input));\n    \n    this.props.history.listen(route => {\n      this.onRouteChange(route);\n    })\n\n    window.addEventListener('scroll', this._onScroll);\n  }\n\n  public componentWillUnmount() {\n    // 组件销毁后，不操作数据\n    this.setState = () => {};\n    window.removeEventListener('scroll', this._onScroll);\n  }\n\n  // 监听路由变化\n  public onRouteChange(route: any) {\n    // 首页\n    if (route.pathname === '/search') {\n      const { scrTop } = this.state;\n      window.addEventListener('scroll', this._onScroll);\n      // 恢复滚动条位置\n      this.setScrollTop(scrTop);\n    }\n    // 详情页\n    if (route.pathname.includes(\"/movie-detail/\")) {\n      // 重置滚动条位置\n      this.setScrollTop(0);\n      window.removeEventListener('scroll', this._onScroll);\n    }\n  }\n\n  // 设置滚动条位置\n  public setScrollTop(top: number) {\n    document.body.scrollTop = top;\n    document.documentElement.scrollTop = top;\n  }\n\n  public _onScroll() {\n    const scrollTop = document.body.scrollTop || document.documentElement.scrollTop;\n\n    if (this.props.location.pathname === '/search') {\n      this.setState({ scrTop: scrollTop });\n    } else {\n      window.removeEventListener('scroll', this._onScroll);\n    }\n  }\n\n  // 根据电影名关键字 搜索 电影\n  public searchMovie(input = '') {\n    if (this.state.isLoading) return;\n    this.setState({ isLoading: true });\n\n    const cache = localStorage.getItem('movieTop250All');\n\n    if (cache) {\n      let movieTop250All = JSON.parse(cache);\n      let searchRes = movieTop250All.filter((item: any) => item.title.includes(input));\n\n      setTimeout(() => {\n        this.setState({ isLoading: false });\n      }, 300);\n      this.setState({ searchList: searchRes });\n\n    } else {\n      getMovieTop250All(res => {\n        if (!Array.isArray(res)) {\n          this.setState({ isLoading: false });\n          Toast.fail('请求失败，请稍后再试！');\n          return;\n        }\n\n        let searchRes = res.filter((item: any) => item.title.includes(input));\n        \n        setTimeout(() => {\n          this.setState({ isLoading: false });\n        }, 300);\n        this.setState({\n          searchList: searchRes\n        });\n      });\n    }\n  }\n\n  public toDetail(id: string) {\n    if (!id) return;\n    this.props.history.push(`/search/movie-detail/${id}`);\n  }\n\n  public onChange(val: string = '') {\n    if (this.inputTimer) clearTimeout(this.inputTimer);\n    this.inputTimer = setTimeout(() => this.searchMovie(val), 600);\n  }\n\n  public onConfirm(val: string) {\n    this.searchMovie(val);\n  }\n\n  public isDetailPage() {\n    return this.props.location.pathname.includes(\"/movie-detail/\");\n  }\n\n  public render() {\n    const { \n      input,\n      isLoading, \n      searchList, \n    } = this.state;\n\n    return (\n      <div \n        className={styles.search} \n        style={{ paddingTop: this.isDetailPage() ? '' : '60px' }} \n      >\n        <div \n          className=\"center-content\"\n          style={{ display: this.isDetailPage() ? 'none' : 'block' }}\n        >\n          {!this.isDetailPage() &&\n            <HeaderSearch \n              value={input} \n              onChange={(val) => this.onChange(val)} \n              onConfirm={(val) => this.onConfirm(val)} \n              onClear={() => this.searchMovie()}\n            />\n          }\n\n          {isLoading && <Loading />}\n\n          <MovieItem movieList={searchList} toDetail={(id: string) => this.toDetail(id)} />\n    \n          <TopBtn />\n        </div>\n\n        {this.props.children}\n      </div>\n    )\n  }\n}\n\nfunction MovieItem({\n  movieList = initMovie,\n  toDetail = (id: string) => {}\n} = {}) {\n  return (\n    <div>\n      <section className=\"desc\">\n        <div>豆瓣电影搜索Api已挂。。。</div>\n        <div>不知道其他Api还能活多久。。。</div>\n        <div>目前的搜索结果来自Top250。。。</div>\n        <br />\n      </section>\n      <div className={`${styles[\"movie-item\"]} desc`}>搜索到 { (movieList[0] && movieList[0].title) ? movieList.length : 0 } 条数据</div>\n      {movieList[0] && movieList[0].title && movieList.map((item, index) => (\n        <section className={styles[\"movie-item\"]} key={index} onClick={() => toDetail(item.id)}>\n          <div className={styles[\"movie-item-pic\"]}>\n            <img src={item.images.small} alt=\"加载中...\" className={styles.img} />\n          </div>\n          <div className={styles[\"movie-item-content\"]}>\n            <div className={styles[\"movie-item-name\"]}>{ item.title }</div>\n            <div className={`${styles[\"movie-item-score\"]} desc`}>\n              {item.rating.average !== 0 \n                ? <React.Fragment>\n                    <Star score={ item.rating.average } readonly={true} />\n                    <span>{ item.rating.average }</span>\n                  </React.Fragment>\n                : <span>尚未上映</span>\n              }\n            </div>\n          </div>\n        </section>\n      ))}\n    </div>\n  );\n}\n\nexport default withRouter(SearchList);\n"],"sourceRoot":""}